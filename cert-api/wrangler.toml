name = "ttai-cert-api"
main = "src/index.ts"
compatibility_date = "2024-11-01"

# KV namespace for certificate storage
[[kv_namespaces]]
binding = "CERT_STORE"
id = "1130d31e8f1c4434b3d4f89b0db504d7"

# Cron trigger for daily certificate renewal check
[triggers]
crons = ["0 3 * * *"] # 3:00 AM UTC daily

# Environment variables (non-secret)
[vars]
CERT_DOMAIN = "local.tt-ai.dev"
# Using ZeroSSL since Let's Encrypt has SSL handshake issues from Workers
ACME_DIRECTORY = "https://acme.zerossl.com/v2/DV90"
# For Let's Encrypt (currently broken from Workers): "https://acme-v02.api.letsencrypt.org/directory"

# Secrets (set via: wrangler secret put <NAME>)
# CF_API_TOKEN - Cloudflare API token with DNS edit permission
# CF_ZONE_ID - Cloudflare zone ID for tt-ai.dev
# EAB_KID - ZeroSSL External Account Binding Key ID (from https://app.zerossl.com/developer)
# EAB_HMAC_KEY - ZeroSSL External Account Binding HMAC Key

# Observability
[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1
