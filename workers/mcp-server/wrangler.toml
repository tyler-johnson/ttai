name = "ttai-mcp-server"
main = "src/index.ts"
compatibility_date = "2024-09-02"
compatibility_flags = ["nodejs_compat"]

[dev]
port = 8787
local_protocol = "http"

[vars]
ENVIRONMENT = "development"

[[services]]
binding = "PYTHON_WORKER"
service = "ttai-python-worker"

# D1 Database - shared with Python worker
[[d1_databases]]
binding = "DB"
database_name = "ttai"
database_id = "local"
migrations_dir = "../../migrations"

# KV Namespace - shared cache for quotes, chains, analysis
[[kv_namespaces]]
binding = "KV"
id = "local"

# R2 Bucket - knowledge base and user exports
[[r2_buckets]]
binding = "R2"
bucket_name = "ttai-storage"

# =============================================================================
# Production environment - deploy with: wrangler deploy --env production
# =============================================================================
[env.production]
vars = { ENVIRONMENT = "production" }

# Create these resources first:
#   wrangler d1 create ttai
#   wrangler kv namespace create TTAI_CACHE
#   wrangler r2 bucket create ttai-storage
#
# Then fill in the IDs below:

[[env.production.d1_databases]]
binding = "DB"
database_name = "ttai"
database_id = "376c59ce-c63b-4ba1-9331-45e66587d2e2"
migrations_dir = "../../migrations"

[[env.production.kv_namespaces]]
binding = "KV"
id = "48b60a0e042149d790031647e4990c1f"

[[env.production.r2_buckets]]
binding = "R2"
bucket_name = "ttai-storage"

# Secrets (set via: wrangler secret put <NAME> --env production)
# - JWT_SECRET
# - TOKEN_ENCRYPTION_KEY
# - TT_CLIENT_ID
# - TT_CLIENT_SECRET
